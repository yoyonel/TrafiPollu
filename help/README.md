# Sphinx: Documentation sous Python

## Sources, références, liens, ...

### Documenting Your Project Using Sphinx
```
This covers just a few of the many many commands available via sphinx. For more, visit http://sphinx.pocoo.org/.

Also, another great site with just an overview of more common commands is http://docs.geoserver.org/trunk/en/docguide/sphinx.html.
```
https://pythonhosted.org/an_example_pypi_project/sphinx.html

#### Example
https://pythonhosted.org/an_example_pypi_project/sphinx.html#full-code-example

-> Resultat: https://pythonhosted.org/an_example_pypi_project/pkgcode.html

### reStructuredText Primer
![](http://sphinx-doc.org/_static/sphinxheader.png)

http://sphinx-doc.org/rest.html

#### reStructuredText Markup Specification
http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html#bullet-lists

### 7. Documenting Python
```
The Python language has a substantial body of documentation, much of it contributed by various authors. The markup used for the Python documentation is reStructuredText, developed by the docutils project, amended by custom directives and using a toolset named Sphinx to post-process the HTML output.

This document describes the style guide for our documentation as well as the custom reStructuredText markup introduced by Sphinx to support Python documentation and how it should be used.
```
https://docs.python.org/devguide/documenting.html

#### Cross-linking markup, Paragraph-level markup
https://docs.python.org/devguide/documenting.html#doc-ref-role

### First Steps with Sphinx
```
This document is meant to give a tutorial-like overview of all common tasks while using Sphinx.
```

### The TOC Tree
```
Since reST does not have facilities to interconnect several documents, or split documents into multiple output files, Sphinx uses a custom directive to add relations between the single files the documentation is made of, as well as tables of contents. The toctree directive is the central element.
```
http://sphinx-doc.org/markup/toctree.html

### Referencing downloadable files
```
This role lets you link to files within your source tree that are not reST documents that can be viewed, but files that can be downloaded.

When you use this role, the referenced file is automatically marked for inclusion in the output when building (obviously, for HTML output only).
All downloadable files are put into the _downloads subdirectory of the output directory; duplicate filenames are handled.
```

http://sphinx-doc.org/markup/inline.html#role-download
http://stackoverflow.com/questions/8475865/in-python-sphinx-how-to-link-to-a-file-in-static-directory

### The Python Domain
`The Python domain (name py) provides the following directives for module declarations:`

http://sphinx-doc.org/domains.html#the-python-domain

### A TESTER: Publishing sphinx-generated docs on github
https://daler.github.io/sphinxdoc-test/includeme.html

github allows the publishing of static pages associated with a particular repository (called project pages), which you can read more about at http://pages.github.com/,

I frequently use Sphinx (http://sphinx.pocoo.org/) for documenting projects, and would like to have my docs for a repo published to the gh-pages for that repo.

This strategy uses ideas from http://lucasbardella.com/report/hosting-your-sphinx-docs-in-github/, which uses a separate directory for docs and keeps the autogenerated stuff out of the main repo. This in contrast to suggestions on http://pages.github.com/, which does stuff within the repo directory. Using a separate docs dir made things easier for me to figure out and configure easier with the Sphinx makefile.

See http://daler.github.com/sphinxdoc-test for the Sphinx-generated version of this README, created using the commands documented in it...


### Referencing downloadable files
```
This role lets you link to files within your source tree that are not reST documents that can be viewed, but files that can be downloaded.

When you use this role, the referenced file is automatically marked for inclusion in the output when building (obviously, for HTML output only).
All downloadable files are put into the _downloads subdirectory of the output directory; duplicate filenames are handled.
```

http://sphinx-doc.org/markup/inline.html#role-download
http://stackoverflow.com/questions/8475865/in-python-sphinx-how-to-link-to-a-file-in-static-directory

### The Python Domain
`The Python domain (name py) provides the following directives for module declarations:`

http://sphinx-doc.org/domains.html#the-python-domain

### A TESTER: Publishing sphinx-generated docs on github
https://daler.github.io/sphinxdoc-test/includeme.html

github allows the publishing of static pages associated with a particular repository (called project pages), which you can read more about at http://pages.github.com/,

I frequently use Sphinx (http://sphinx.pocoo.org/) for documenting projects, and would like to have my docs for a repo published to the gh-pages for that repo.

This strategy uses ideas from http://lucasbardella.com/report/hosting-your-sphinx-docs-in-github/, which uses a separate directory for docs and keeps the autogenerated stuff out of the main repo. This in contrast to suggestions on http://pages.github.com/, which does stuff within the repo directory. Using a separate docs dir made things easier for me to figure out and configure easier with the Sphinx makefile.

See http://daler.github.com/sphinxdoc-test for the Sphinx-generated version of this README, created using the commands documented in it...


## Probleme avec autodoc et les Décorateurs Python

###  @task decorator causes Sphinx autodoc to lose fuction signature #569
https://github.com/fabric/fabric/issues/569

->  Use 3rd party "decorator" module to fix introspection for decorated functions #103
https://github.com/fabric/fabric/issues/103

=> use functools.wraps

#### 9.2. functools — Higher-order functions and operations on callable objects¶
https://docs.python.org/3.2/library/functools.html

#### Timing Decorator using wraps
http://stackoverflow.com/a/27737385
```python
from functools import wraps
from time import time

def timing(f):
    @wraps(f)
    def wrap(*args, **kw):
        ts = time()
        result = f(*args, **kw)
        te = time()
        print 'func:%r args:[%r, %r] took: %2.4f sec' % \
          (f.__name__, args, kw, te-ts)
        return result
    return wrap
```    

#### Implementation dans TrafiPollu
```python
def timer_decorator(f, prefix="-> TIMER\n\t", postfix=""):
    """

    :param f:
    :param prefix:
    :param postfix:
    :return:
    """
    @wraps(f)
    def wrap(*args, **kw):
        """

        :param args:
        :param kw:
        :return:
        """
        global t
        try:
            with Timer() as t:
                result = f(*args, **kw)
        finally:
            print '{0:s}{1:s} took {2:.03f} sec.{3:s}'.format(prefix,
                                                              f.__name__,
                                                              t.interval,
                                                              postfix)
        return result
    return wrap
```
