<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>trafipolluImp_SQL &mdash; interactive_map_tracking 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="interactive_map_tracking 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">interactive_map_tracking 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for trafipolluImp_SQL</h1><div class="highlight"><pre>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;latty&#39;</span>

<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span> <span class="n">QgsCoordinateTransform</span><span class="p">,</span> <span class="n">QgsGeometry</span>

<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">psycopg2.extras</span>

<span class="kn">import</span> <span class="nn">trafipolluImp_DUMP</span> <span class="kn">as</span> <span class="nn">tpi_DUMP</span>
<span class="kn">import</span> <span class="nn">imt_tools</span>
<span class="kn">import</span> <span class="nn">trafipolluImp_Tools_Symuvia</span> <span class="kn">as</span> <span class="nn">tpi_TS</span>

<span class="kn">from</span> <span class="nn">imt_tools</span> <span class="kn">import</span> <span class="n">build_logger</span>
<span class="c"># creation de l&#39;objet logger qui va nous servir a ecrire dans les logs</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">build_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">Config_Tools</span> <span class="kn">import</span> <span class="n">CConfig</span>

<span class="kn">import</span> <span class="nn">os</span>


<span class="n">qgis_plugins_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>


<div class="viewcode-block" id="trafipolluImp_SQL"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL">[docs]</a><span class="k">class</span> <span class="nc">trafipolluImp_SQL</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Implementation du module SQL</span>

<span class="sd">    Utilise pour gerer la communication entre la BDD StreetGen et Python/QGIS.</span>

<span class="sd">    Module principalement utilise pour le DUMP des donnees, et partiellement pour la TOPO (pb de design ... :/ a revoir)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="trafipolluImp_SQL.__init__"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation du module SQL:</span>
<span class="sd">            - Recuperation des donnees du parent (dicts: edges, node, lanes, ...)</span>
<span class="sd">            - Declaration de la liste des scripts SQL pris en charges</span>
<span class="sd">            - Recuperation des donnees de connexions a la BDD (utilisation du module &#39;Config&#39;)</span>
<span class="sd">            - Tentative d&#39;etablissement de la connection</span>

<span class="sd">        .. note::</span>
<span class="sd">            Il faudra (peut etre) revoir ce mecanisme de connection.</span>

<span class="sd">            Ce n&#39;est surement pas judicieux de le placer dans l&#39;init de ce module</span>
<span class="sd">            (qui est dans l&#39;init du parent, donc du plugin, donc au chargement de QGIS)</span>

<span class="sd">        :param kwargs: dictionnaire (unpack) des parametres/donnees du plugin (mecanisme de transmission)</span>
<span class="sd">        :type kwargs: dict</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dict_edges&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dict_nodes&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lanes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dict_lanes&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_roundabouts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dict_roundabouts&#39;</span><span class="p">]</span>

        <span class="n">iface</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;iface&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_canvas</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dict_sql_methods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;update_def_zone_test&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_tables_from_qgis</span><span class="p">,</span>
            <span class="s">&#39;update_table_edges_from_qgis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_tables_from_qgis</span><span class="p">,</span>
            <span class="s">&#39;update_tables_from_def_zone_test&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_tables_from_qgis</span><span class="p">,</span>
            <span class="c">#</span>
            <span class="s">&#39;update_table_detecting_roundabouts_from_qgis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_tables_from_qgis</span><span class="p">,</span>
            <span class="c">#</span>
            <span class="s">&#39;dump_informations_from_edges&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_edges</span><span class="p">,</span>
            <span class="s">&#39;dump_sides_from_edges&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_lanes</span><span class="p">,</span>
            <span class="s">&#39;dump_informations_from_nodes&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_nodes</span><span class="p">,</span>
            <span class="s">&#39;dump_informations_from_lane_interconnexion&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_interconnexions</span><span class="p">,</span>
            <span class="c"># TODO: travail sur les rond points [desactiver]</span>
            <span class="c"># &#39;dump_roundabouts&#39;: self._request_for_roundabouts</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span> <span class="o">=</span> <span class="n">qgis_plugins_directory</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> \
                               <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;config_filename&#39;</span><span class="p">,</span> <span class="s">&#39;config_&#39;</span> <span class="o">+</span> <span class="n">__name__</span> <span class="o">+</span> <span class="s">&#39;.ini&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Config INI filename: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Config</span> <span class="o">=</span> <span class="n">CConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">)</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Config</span>  <span class="c"># alias sur la Config</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ParsingError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;can&#39;t read the file: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_filename</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Utilisation des valeurs par defaut (orientees pour une target precise)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="c"># load une section du fichier config</span>
        <span class="n">configs</span><span class="o">.</span><span class="n">load_section</span><span class="p">(</span><span class="s">&#39;SQL_LOCAL_SERVER&#39;</span><span class="p">)</span>
        <span class="n">configs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span><span class="p">[</span><span class="s">&#39;LOCAL&#39;</span><span class="p">],</span>
            <span class="p">{</span>
                <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span> <span class="s">&#39;localhost&#39;</span><span class="p">),</span>
                <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">,</span> <span class="s">&#39;5433&#39;</span><span class="p">),</span>
                <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;postgres&#39;</span><span class="p">),</span>
                <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;postgres&#39;</span><span class="p">),</span>
                <span class="s">&#39;connect_timeout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">),</span>
                <span class="c">#</span>
                <span class="s">&#39;dbname&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;dbname&#39;</span><span class="p">,</span> <span class="s">&#39;street_gen_3&#39;</span><span class="p">),</span>
                <span class="s">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">,</span> <span class="s">&#39;bdtopo_topological&#39;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c"># recuperation des options liees a la section courante &#39;SQL_LOCAL_SERVER&#39;</span>
        <span class="c"># load une section du fichier config</span>
        <span class="n">configs</span><span class="o">.</span><span class="n">load_section</span><span class="p">(</span><span class="s">&#39;SQL_IGN_SERVER&#39;</span><span class="p">)</span>
        <span class="c"># recuperation des options liees a la section courante &#39;SQL_IGN_SERVER&#39;</span>
        <span class="n">configs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span><span class="p">[</span><span class="s">&#39;IGN&#39;</span><span class="p">],</span>
            <span class="p">{</span>
                <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span> <span class="s">&#39;172.16.3.50&#39;</span><span class="p">),</span>
                <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">,</span> <span class="s">&#39;5432&#39;</span><span class="p">),</span>
                <span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;streetgen&#39;</span><span class="p">),</span>
                <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;streetgen&#39;</span><span class="p">),</span>
                <span class="s">&#39;connect_timeout&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">),</span>
                <span class="c">#</span>
                <span class="s">&#39;dbname&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;dbname&#39;</span><span class="p">,</span> <span class="s">&#39;street_gen_4&#39;</span><span class="p">),</span>
                <span class="s">&#39;database&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;database&#39;</span><span class="p">,</span> <span class="s">&#39;bdtopo_topological&#39;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_sql_server</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Appel: disconnect_sql_server</span>


<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_sql_server</span><span class="p">()</span>

<div class="viewcode-block" id="trafipolluImp_SQL.disconnect_sql_server"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.disconnect_sql_server">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect_sql_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Deconnection au serveur DB-StreetGen</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c"># TODO: a tester avant de valider la suppression de ce code</span>
    <span class="c"># def get_value(self, name_server, option):</span>
    <span class="c">#     &quot;&quot;&quot;</span>
    <span class="c">#</span>
    <span class="c">#     :param name_server:</span>
    <span class="c">#     :type name_server: str</span>
    <span class="c">#     :param option:</span>
    <span class="c">#     :type option: str</span>
    <span class="c">#     :return:</span>
    <span class="c">#     &quot;&quot;&quot;</span>
    <span class="c">#     return self.__dict__[&#39;sql_&#39; + name_server + &#39;_&#39; + option]</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL.connect_sql_server"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.connect_sql_server">[docs]</a>    <span class="k">def</span> <span class="nf">connect_sql_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Tente de se connecter au serveur DB-StreetGen, suivant les parametres de connexions recuperes.</span>

<span class="sd">        :return: Renvoie:</span>

<span class="sd">           True  -- Si on a trouve une connection valide vers BD-StreetGen</span>
<span class="sd">           False -- Sinon</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># boucle sur la listes des parametres serveurs (possibles)</span>
        <span class="k">for</span> <span class="n">name_server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># on tente d&#39;etablir une connection au serveur</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span><span class="p">[</span><span class="n">name_server</span><span class="p">])</span>
            <span class="k">except</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;[SQL] PsyCopg2 Error : </span><span class="si">%s</span><span class="s"> - Detail: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pgerror</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">message_detail</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># cursor utilise: DictCursor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">cursor_factory</span><span class="o">=</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extras</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;PostGres : problem pour recuperer un cursor -&gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="c"># Logs: informations sur le serveur &#39;valide&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connect_sql_server_log</span><span class="p">(</span><span class="n">name_server</span><span class="p">)</span>
                    <span class="c"># on sort des qu&#39;on a etablie une connection valide</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;Impossible de se connecter a un serveur !&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL.connect_sql_server_log"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.connect_sql_server_log">[docs]</a>    <span class="k">def</span> <span class="nf">connect_sql_server_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_server</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        LOG: on log les informations du serveur avec lequel on a etablit une connection &#39;valide&#39;</span>

<span class="sd">        :param name_server: id d&#39;un jeu de parametres valides pour se connecteur a un serveur DB-StreetGen</span>
<span class="sd">        :type name_server: str</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;connected with </span><span class="si">%s</span><span class="s"> server&#39;</span> <span class="o">%</span> <span class="n">name_server</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;informations de connections:&#39;</span><span class="p">)</span>
        <span class="nb">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&#39;- &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dict_params_server</span><span class="p">[</span><span class="n">name_server</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="trafipolluImp_SQL._update_tables_from_qgis"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._update_tables_from_qgis">[docs]</a>    <span class="k">def</span> <span class="nf">_update_tables_from_qgis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Methode utlisee par les id scripts SQL:</span>

<span class="sd">            - :download:`update_def_zone_test.sql &lt;../../update_def_zone_test.sql&gt;`.</span>
<span class="sd">            - :download:`update_table_edges_from_qgis.sql &lt;../../update_table_edges_from_qgis.sql&gt;`.</span>
<span class="sd">            - :download:`update_tables_from_def_zone_test.sql &lt;../../update_tables_from_def_zone_test.sql&gt;`.</span>
<span class="sd">            - :download:`update_table_detecting_roundabouts_from_qgis.sql &lt;../../update_table_detecting_roundabouts_from_qgis.sql&gt;`.</span>

<span class="sd">        pour mettre a jour les vues SQL utilisees pour definir la zone de DUMP StreetGen -&gt; Python/Symuvia</span>

<span class="sd">        :param kwargs: Dictionnaire des parametres (transmis)</span>
<span class="sd">        :type kwargs: (unpack) dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># on recupere la &#39;connection&#39; prealablement etablie</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;connection&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No connection ! -&gt; {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;try to commit ...&quot;</span><span class="p">)</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Probleme au moment du commit ! -&gt; {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL.build_sql_parameters_with_map_extent"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.build_sql_parameters_with_map_extent">[docs]</a>    <span class="k">def</span> <span class="nf">build_sql_parameters_with_map_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fonctions convertissant l&#39;extent de visualisation courante dans QGIS en polygone PostGIS</span>
<span class="sd">        (dans le bon systeme de coordonne Srid).</span>

<span class="sd">        Le resultat est transmis via un dictionnaire de parametres qui sera utilise par insertion dans les scripts SQL</span>

<span class="sd">        :return: Dictionnaire de parametres contenant un polygone PostGIS de l&#39;extent QGIS</span>
<span class="sd">        :rtype: dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapCanvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_canvas</span>
        <span class="n">mapCanvas_extent</span> <span class="o">=</span> <span class="n">mapCanvas</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
        <span class="c"># get the list points from the current extent (from QGIS MapCanvas)</span>
        <span class="n">list_points_from_mapcanvas</span> <span class="o">=</span> <span class="n">imt_tools</span><span class="o">.</span><span class="n">construct_listpoints_from_extent</span><span class="p">(</span><span class="n">mapCanvas_extent</span><span class="p">)</span>

        <span class="c"># url: http://qgis.org/api/classQgsMapCanvas.html#af0ffae7b5e5ec8b29764773fa6a74d58</span>
        <span class="n">extent_src_crs</span> <span class="o">=</span> <span class="n">mapCanvas</span><span class="o">.</span><span class="n">mapSettings</span><span class="p">()</span><span class="o">.</span><span class="n">destinationCrs</span><span class="p">()</span>
        <span class="c"># url: http://qgis.org/api/classQgsCoordinateReferenceSystem.html#a3cb64f24049d50fbacffd1eece5125ee</span>
        <span class="c"># srid of translated lambert 93 to match laser referential</span>
        <span class="n">extent_postgisSrid</span> <span class="o">=</span> <span class="mi">932011</span>
        <span class="n">extent_dst_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="n">extent_postgisSrid</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="o">.</span><span class="n">PostgisCrsId</span><span class="p">)</span>
        <span class="c"># url: http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/crs.html</span>
        <span class="n">xform</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">extent_src_crs</span><span class="p">,</span> <span class="n">extent_dst_crs</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="n">list_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">xform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">list_points_from_mapcanvas</span><span class="p">]</span>
        <span class="c"># list of lists of points</span>
        <span class="n">gPolyline</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolyline</span><span class="p">(</span><span class="n">list_points</span><span class="p">)</span>
        <span class="n">gPolylineWkt</span> <span class="o">=</span> <span class="n">gPolyline</span><span class="o">.</span><span class="n">exportToWkt</span><span class="p">()</span>

        <span class="n">dict_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;gPolylineWkt&#39;</span><span class="p">:</span> <span class="n">gPolylineWkt</span><span class="p">,</span>
            <span class="s">&#39;extent_postgisSrid&#39;</span><span class="p">:</span> <span class="n">extent_postgisSrid</span>
        <span class="p">}</span>

        <span class="c">#######</span>
        <span class="c"># LOG #</span>
        <span class="c">#######</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* list_points_from_mapcanvas: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">list_points_from_mapcanvas</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* gPolygonWkt: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">gPolylineWkt</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* extent_postgisSrid: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">extent_postgisSrid</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;extent_src_crs.postgisSrid: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">extent_src_crs</span><span class="o">.</span><span class="n">postgisSrid</span><span class="p">())</span>
        <span class="c">#######</span>

        <span class="k">return</span> <span class="n">dict_parameters</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL.build_sql_parameters_with_map_extent_for_roundabouts"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.build_sql_parameters_with_map_extent_for_roundabouts">[docs]</a>    <span class="k">def</span> <span class="nf">build_sql_parameters_with_map_extent_for_roundabouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        idem que &#39;build_sql_parameters_with_map_extent&#39;</span>
<span class="sd">        .. note::</span>
<span class="sd">        Faudrait penser a fusionner/refactorer cette partie</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapCanvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_canvas</span>
        <span class="n">mapCanvas_extent</span> <span class="o">=</span> <span class="n">mapCanvas</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
        <span class="c"># get the list points from the current extent (from QGIS MapCanvas)</span>
        <span class="n">list_points_from_mapcanvas</span> <span class="o">=</span> <span class="n">imt_tools</span><span class="o">.</span><span class="n">construct_listpoints_from_extent</span><span class="p">(</span><span class="n">mapCanvas_extent</span><span class="p">)</span>

        <span class="c"># url: http://qgis.org/api/classQgsMapCanvas.html#af0ffae7b5e5ec8b29764773fa6a74d58</span>
        <span class="n">extent_src_crs</span> <span class="o">=</span> <span class="n">mapCanvas</span><span class="o">.</span><span class="n">mapSettings</span><span class="p">()</span><span class="o">.</span><span class="n">destinationCrs</span><span class="p">()</span>
        <span class="c"># url: http://qgis.org/api/classQgsCoordinateReferenceSystem.html#a3cb64f24049d50fbacffd1eece5125ee</span>
        <span class="c"># srid of translated lambert 93 to match laser referential</span>
        <span class="n">extent_postgisSrid</span> <span class="o">=</span> <span class="mi">932011</span>
        <span class="n">extent_dst_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="n">extent_postgisSrid</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="o">.</span><span class="n">PostgisCrsId</span><span class="p">)</span>
        <span class="c"># url: http://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/crs.html</span>
        <span class="n">xform</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">extent_src_crs</span><span class="p">,</span> <span class="n">extent_dst_crs</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="n">list_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">xform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">list_points_from_mapcanvas</span><span class="p">]</span>

        <span class="c"># list of lists of points</span>
        <span class="n">gPolygon</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolygon</span><span class="p">([</span><span class="n">list_points</span><span class="p">])</span>
        <span class="n">gPolygoneWkt</span> <span class="o">=</span> <span class="n">gPolygon</span><span class="o">.</span><span class="n">exportToWkt</span><span class="p">()</span>

        <span class="n">dict_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;gPolygonWkt&#39;</span><span class="p">:</span> <span class="n">gPolygoneWkt</span><span class="p">,</span>
            <span class="s">&#39;extent_postgisSrid&#39;</span><span class="p">:</span> <span class="n">extent_postgisSrid</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* list_points_from_mapcanvas: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">list_points_from_mapcanvas</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* gPolygonWkt: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">gPolygoneWkt</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;* extent_postgisSrid: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">extent_postgisSrid</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;extent_src_crs.postgisSrid: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">extent_src_crs</span><span class="o">.</span><span class="n">postgisSrid</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">dict_parameters</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="trafipolluImp_SQL.build_sql_parameters_with_update_def_zone_test"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.build_sql_parameters_with_update_def_zone_test">[docs]</a>    <span class="k">def</span> <span class="nf">build_sql_parameters_with_update_def_zone_test</span><span class="p">(</span>
            <span class="n">b_update_def_zone_test_with_convex_hull_on_symuvia_network</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fonctions construisant un polygone PostGIS pour definir une zone de travail pour les scripts de DUMP.</span>

<span class="sd">        Cette zone (polygone) est constuire a partir de l&#39;extraction d&#39;une empreinte geographique liee a un reseau</span>
<span class="sd">        Symuvia.</span>

<span class="sd">        Voir dans :py:mod:`trafipolluImp_Tools_Symuvia` pour des details sur l&#39;empreinte d&#39;un reseau Symuvia.</span>

<span class="sd">        Le resultat est transmis via un dictionnaire de parametres qui sera utilise par insertion dans les scripts SQL</span>

<span class="sd">        .. warning::</span>
<span class="sd">            Non stable, a revoir.</span>
<span class="sd">            Fonctionne avec SG3 mais pas SG4 ...</span>

<span class="sd">        :param b_update_def_zone_test_with_convex_hull_on_symuvia_network:</span>
<span class="sd">        :type b_update_def_zone_test_with_convex_hull_on_symuvia_network: bool</span>
<span class="sd">        :param kwargs: Dictionnaire de parametres (transmis)</span>
<span class="sd">        :type kwargs: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gPolygonWkt</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">b_update_def_zone_test_with_convex_hull_on_symuvia_network</span><span class="p">:</span>
            <span class="n">shp_convex_hull</span><span class="p">,</span> <span class="n">shp_list_extremites</span> <span class="o">=</span> <span class="n">tpi_TS</span><span class="o">.</span><span class="n">extract_convexhull_from_symuvia_network</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">gPolygonWkt</span> <span class="o">=</span> <span class="n">shp_convex_hull</span><span class="o">.</span><span class="n">wkt</span>

        <span class="k">if</span> <span class="n">gPolygonWkt</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="c"># Convex hull du reseau symuvia &#39;/home/latty/__DEV__/__Ifsttar__/Envoi_IGN_2015_07/reseau_paris6_v31.xml&#39;</span>
            <span class="n">gPolygonWkt</span> <span class="o">=</span> <span class="s">&#39;POLYGON ((650701.858831 6860988.892569, 650685.579302 6860989.63957, 650637.589042 6861000.671025, 650625.9989689999 6861022.21112, 650475.062469 6861507.425974, 650919.609638 6862039.011138, 650988.736866 6862060.741522, 651337.303769 6861890.548595, 651383.122202 6861735.047361, 651396.56811 6861476.753853, 651404.1191219999 6861230.871522, 651403.524419 6861226.192165, 651019.06407 6861047.190387, 650836.022246 6861012.096856, 650701.858831 6860988.892569))&#39;</span>

        <span class="n">gPolygonSRID</span> <span class="o">=</span> <span class="mi">2154</span>  <span class="c"># SRID du Lambert93</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;################ gPolygonWkt: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gPolygonWkt</span><span class="p">))</span>

        <span class="n">dict_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;gPolygonWkt&#39;</span><span class="p">:</span> <span class="n">gPolygonWkt</span><span class="p">,</span>
            <span class="s">&#39;gPolygonSRID&#39;</span><span class="p">:</span> <span class="n">gPolygonSRID</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">dict_parameters</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL.execute_sql_commands"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL.execute_sql_commands">[docs]</a>    <span class="k">def</span> <span class="nf">execute_sql_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql_file</span><span class="p">,</span> <span class="n">id_sql_method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Execute les commandes SQL contenues dans le script &#39;sql_file&#39; identifie par &#39;id_sql_method&#39;.</span>

<span class="sd">        Si l&#39;id du script est soit:</span>

<span class="sd">            - update_table_edges_from_qgis</span>
<span class="sd">            - update_table_detecting_roundabouts_from_qgis</span>
<span class="sd">            - update_def_zone_test</span>

<span class="sd">        -&gt; alors le calcul des parametres de zone d&#39;extraction (a partir de l&#39;extent QGIS ou d&#39;une empreinte de reseau</span>
<span class="sd">        Symuvia, ou autre) pour les transmettre par la suite au script SQL (aux commandes du script).</span>

<span class="sd">        Dans tous les cas, on parse le script SQL pour executer toutes les commandes inclues dans le fichier script.</span>

<span class="sd">        :param sql_file: nom du fichier script SQL a executer</span>
<span class="sd">        :type sql_file: str</span>
<span class="sd">        :param id_sql_method: identifiant du script SQL a executer</span>
<span class="sd">        :type id_sql_method: str</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_sql_server</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_connection_to_postgres_server</span><span class="p">:</span>

            <span class="n">dict_parameters</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">id_sql_method</span> <span class="o">==</span> <span class="s">&#39;update_table_edges_from_qgis&#39;</span><span class="p">:</span>
                <span class="n">dict_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_sql_parameters_with_map_extent</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">id_sql_method</span> <span class="o">==</span> <span class="s">&#39;update_table_detecting_roundabouts_from_qgis&#39;</span><span class="p">:</span>
                <span class="n">dict_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_sql_parameters_with_map_extent_for_roundabouts</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">id_sql_method</span> <span class="o">==</span> <span class="s">&#39;update_def_zone_test&#39;</span><span class="p">:</span>
                <span class="n">dict_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_sql_parameters_with_update_def_zone_test</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">sql_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_sql_methods</span><span class="p">[</span><span class="n">id_sql_method</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">sql_method</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Pas de methode (python) associee au script sql: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="c"># all SQL commands (split on &#39;;&#39;)</span>
            <span class="n">sqlCommands</span> <span class="o">=</span> <span class="n">sql_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>

            <span class="c"># Execute every command from the input file</span>
            <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">sqlCommands</span><span class="p">:</span>
                <span class="c"># This will skip and report errors</span>
                <span class="c"># For example, if the tables do not yet exist, this will skip over</span>
                <span class="c"># the DROP TABLE commands</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># command = command.format(gPolylineWkt, extent_postgisSrid)</span>
                    <span class="c"># https://docs.python.org/2/library/string.html#string.Formatter</span>
                    <span class="c"># todo : look here for more advanced features on string formatter</span>
                    <span class="c"># command = command.format(**dict_parameters)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                        <span class="c"># url: http://initd.org/psycopg/docs/usage.html#query-parameters</span>
                        <span class="c"># url: http://initd.org/psycopg/docs/advanced.html#adapting-new-types</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">dict_parameters</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;psycopg2.ProgrammingError: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">id_sql_method</span> <span class="o">==</span> <span class="s">&#39;update_def_zone_test&#39;</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;-&gt; probleme connu avec &#39;update_def_zone_test&#39;. Lie a la lib psycopg2&quot;</span><span class="p">)</span>

                        <span class="n">sql_method</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Command skipped: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                    <span class="c"># #</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_entity"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_entity">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation generique pour le dump (fetch SQL) des donnees.</span>

<span class="sd">        kwargs doit contenir (au moins) 2 keys:</span>
<span class="sd">            - func_for_dumping: function de dump pour recuperer les informations sur la base DB-StreetGen</span>
<span class="sd">            - meth_post_request: methode de post traitement apres la recuperation des informations</span>

<span class="sd">        :param kwargs: Dictionnaire de parametres (transmis)</span>
<span class="sd">        :type kwargs: dict.</span>
<span class="sd">        :return: Code de retour:</span>

<span class="sd">            1   -- aucun probleme</span>
<span class="sd">            -1  -- pas de cursor disponible</span>
<span class="sd">            -2  -- probleme pendant le fetchall SQL</span>

<span class="sd">        :rtype: int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;cursor&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Pas de cursor disponible!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;try to cursor.fetchall ...&quot;</span><span class="p">)</span>
                <span class="n">objects_from_sql_request</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Probleme lors d&#39;un &#39;fetchall&#39; -&gt; Exception: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">post_resquest_for_entity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;meth_post_request&#39;</span><span class="p">]</span>
                    <span class="n">dump_for_entity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;func_for_dumping&#39;</span><span class="p">]</span>
                    <span class="n">post_resquest_for_entity</span><span class="p">(</span><span class="n">dump_for_entity</span><span class="p">(</span><span class="n">objects_from_sql_request</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Pb! -&gt; {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">return</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_roundabouts"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_roundabouts">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_roundabouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation specialisee pour le DUMP d&#39;informations sur les rond-points.</span>

<span class="sd">        Voir: :py:func:`_request_for_entity`</span>

<span class="sd">        :param kwargs:</span>
<span class="sd">        :type kwargs: str</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">&#39;meth_post_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request_for_roundabouts</span><span class="p">,</span>
                <span class="s">&#39;func_for_dumping&#39;</span><span class="p">:</span> <span class="n">tpi_DUMP</span><span class="o">.</span><span class="n">dump_for_roundabouts</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_entity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._post_request_for_roundabouts"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._post_request_for_roundabouts">[docs]</a>    <span class="k">def</span> <span class="nf">_post_request_for_roundabouts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_dump</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation de la post-request pour les rond-points.</span>

<span class="sd">        Transfert des donnees recuperees pour les rond-points dans les structures de donnees Python</span>

<span class="sd">        :param results_dump: Dictionnaire contenant le DUMP des informations SQL-StreetGen sur les rond-points</span>
<span class="sd">        :type results_dump: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_roundabouts</span> <span class="o">=</span> <span class="n">results_dump</span>

        <span class="k">for</span> <span class="n">ra_id</span><span class="p">,</span> <span class="n">ra_dump</span> <span class="ow">in</span> <span class="n">dict_roundabouts</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c"># ajouter les informations aux &#39;nodes&#39;</span>
            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">ra_dump</span><span class="p">[</span><span class="s">&#39;list_nodes&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;roundabouts&#39;</span><span class="p">:</span> <span class="n">ra_id</span><span class="p">})</span>
            <span class="c"># ajouter les informations aux &#39;edges&#39;</span>
            <span class="k">for</span> <span class="n">edge_id</span> <span class="ow">in</span> <span class="n">ra_dump</span><span class="p">[</span><span class="s">&#39;list_edges&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">edge_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span><span class="p">[</span><span class="n">edge_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;roundabouts&#39;</span><span class="p">:</span> <span class="n">ra_id</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_roundabouts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_roundabouts</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_edges"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_edges">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation specialisee pour le DUMP d&#39;informations sur les edges/aretes/troncons.</span>

<span class="sd">        Voir: :py:func:`_request_for_entity`</span>

<span class="sd">        :param kwargs:</span>
<span class="sd">        :type kwargs: str</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">&#39;meth_post_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request_for_edges</span><span class="p">,</span>
                <span class="s">&#39;func_for_dumping&#39;</span><span class="p">:</span> <span class="n">tpi_DUMP</span><span class="o">.</span><span class="n">dump_for_edges</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_entity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._post_request_for_edges"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._post_request_for_edges">[docs]</a>    <span class="k">def</span> <span class="nf">_post_request_for_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_dump</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation de la post-request pour les edges.</span>

<span class="sd">        Transfert des donnees recuperees pour les edges dans les structures de donnees Python</span>

<span class="sd">        :param results_dump: Dictionnaire contenant le DUMP des informations SQL-StreetGen sur les edges</span>
<span class="sd">        :type results_dump: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_edges</span> <span class="o">=</span> <span class="n">results_dump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_edges</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_nodes"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation specialisee pour le DUMP d&#39;informations sur les nodes/noeuds/centre d&#39;intersections</span>

<span class="sd">        Voir: :py:func:`_request_for_entity`</span>

<span class="sd">        :param kwargs:</span>
<span class="sd">        :type kwargs: str</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">&#39;meth_post_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request_for_nodes</span><span class="p">,</span>
                <span class="s">&#39;func_for_dumping&#39;</span><span class="p">:</span> <span class="n">tpi_DUMP</span><span class="o">.</span><span class="n">dump_for_nodes</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_entity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._post_request_for_nodes"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._post_request_for_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">_post_request_for_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_dump</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation de la post-request pour les nodes.</span>

<span class="sd">        Transfert des donnees recuperees pour les nodes dans les structures de donnees Python</span>

<span class="sd">        :param results_dump: Dictionnaire contenant le DUMP des informations SQL-StreetGen sur les nodes</span>
<span class="sd">        :type results_dump: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_nodes</span> <span class="o">=</span> <span class="n">results_dump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_nodes</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_interconnexions"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_interconnexions">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_interconnexions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation specialisee pour le DUMP d&#39;informations sur les interconnexions</span>

<span class="sd">        Voir: :py:func:`_request_for_entity`</span>

<span class="sd">        :param kwargs:</span>
<span class="sd">        :type kwargs: str</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">&#39;meth_post_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request_for_interconnexions</span><span class="p">,</span>
                <span class="s">&#39;func_for_dumping&#39;</span><span class="p">:</span> <span class="n">tpi_DUMP</span><span class="o">.</span><span class="n">dump_for_interconnexions</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_entity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._post_request_for_interconnexions"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._post_request_for_interconnexions">[docs]</a>    <span class="k">def</span> <span class="nf">_post_request_for_interconnexions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_dump</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation de la post-request pour les interconnexions.</span>

<span class="sd">        Transfert des donnees recuperees pour les interconnexions dans les structures de donnees Python</span>

<span class="sd">        :param results_dump: Dictionnaire contenant le DUMP des informations SQL-StreetGen sur les interconnexions</span>
<span class="sd">        :type results_dump: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_interconnexions</span><span class="p">,</span> <span class="n">dict_set_id_edges</span> <span class="o">=</span> <span class="n">results_dump</span>

        <span class="c"># ajouter les informations d&#39;interconnexions au noeud</span>
        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">interconnexions</span> <span class="ow">in</span> <span class="n">dict_interconnexions</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s">&#39;interconnexions&#39;</span><span class="p">:</span> <span class="n">interconnexions</span><span class="p">,</span>
                    <span class="s">&#39;set_id_edges&#39;</span><span class="p">:</span> <span class="n">dict_set_id_edges</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._request_for_lanes"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._request_for_lanes">[docs]</a>    <span class="k">def</span> <span class="nf">_request_for_lanes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation specialisee pour le DUMP d&#39;informations sur les lanes/voies</span>

<span class="sd">        Voir: :py:func:`_request_for_entity`</span>

<span class="sd">        :param kwargs:</span>
<span class="sd">        :type kwargs: str</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">&#39;meth_post_request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request_for_lanes</span><span class="p">,</span>
                <span class="s">&#39;func_for_dumping&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tpi_DUMP</span><span class="o">.</span><span class="n">dump_lanes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_for_entity</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="trafipolluImp_SQL._post_request_for_lanes"><a class="viewcode-back" href="../tp_composants.html#trafipolluImp_SQL.trafipolluImp_SQL._post_request_for_lanes">[docs]</a>    <span class="k">def</span> <span class="nf">_post_request_for_lanes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_dump</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Implementation de la post-request pour les lanes/voies.</span>

<span class="sd">        Transfert des donnees recuperees pour les lanes/voies dans les structures de donnees Python</span>

<span class="sd">        :param results_dump: Dictionnaire contenant le DUMP des informations SQL-StreetGen sur les lanes/voies</span>
<span class="sd">        :type results_dump: dict.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_lanes</span><span class="p">,</span> <span class="n">dict_grouped_lanes</span> <span class="o">=</span> <span class="n">results_dump</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_lanes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dict_lanes</span><span class="p">)</span>
        <span class="c"># update dict_edges with lanes grouped informations</span>
        <span class="k">for</span> <span class="n">sg3_edge_id</span><span class="p">,</span> <span class="n">grouped_lanes</span> <span class="ow">in</span> <span class="n">dict_grouped_lanes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_edges</span><span class="p">[</span><span class="n">sg3_edge_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grouped_lanes</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">interactive_map_tracking 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Lionel Atty, IGN, SIDT.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>